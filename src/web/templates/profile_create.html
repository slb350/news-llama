{% extends "base.html" %}

{% block title %}Create Profile - News Llama{% endblock %}

{% block content %}
<div class="card-static shadow-lg p-8">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Your Profile</h1>
        <p class="text-sm text-gray-500 uppercase tracking-wide">Personalize Your News Experience</p>
    </div>

    <!-- Form -->
    <form hx-post="/profile/create"
          hx-trigger="submit"
          hx-target="body"
          class="space-y-8">

        <!-- Profile Name -->
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2" for="first_name">
                First Name
            </label>
            <input
                type="text"
                id="first_name"
                name="first_name"
                required
                placeholder="Enter your first name"
                class="w-full"
            >
        </div>

        <!-- Avatar Upload -->
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Profile Avatar (Optional)
            </label>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-coral-accent transition-colors">
                <div class="profile-avatar mx-auto mb-4" style="width: 80px; height: 80px; font-size: 2rem;" id="avatar-preview">
                    ðŸ“·
                </div>
                <input
                    type="file"
                    id="avatar"
                    name="avatar"
                    accept="image/*"
                    class="hidden"
                    hx-post="/profile/avatar"
                    hx-encoding="multipart/form-data"
                    hx-target="#avatar-preview"
                >
                <label for="avatar" class="btn-secondary inline-block">
                    Choose Image
                </label>
                <p class="text-xs text-gray-500 mt-2">Max 500KB, 512x512px recommended</p>
            </div>
        </div>

        <!-- Interest Selection -->
        <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
                Select Your Interests (5-20 recommended)
            </label>

            <!-- Search Box -->
            <input
                type="search"
                placeholder="Add any interest or choose from pre-configured categories below..."
                class="w-full mb-4"
                hx-get="/interests/autocomplete"
                hx-trigger="keyup changed delay:300ms"
                hx-target="#interest-suggestions"
            >

            <!-- Selected Interests -->
            <div class="coral-bg-light rounded-lg p-4 mb-4 min-h-[60px]">
                <div class="text-xs text-gray-600 uppercase tracking-wide font-semibold mb-2">
                    Selected Interests (click to remove)
                </div>
                <div id="selected-interests" class="flex flex-wrap gap-2">
                    <span class="text-xs text-gray-500">No interests selected yet</span>
                </div>
            </div>

            <!-- Available Interests (5x20 grid mockup) -->
            <div class="mb-2">
                <div class="text-xs text-gray-600 uppercase tracking-wide font-semibold mb-2">
                    Pre-configured Categories (click to add)
                </div>
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2" id="interest-suggestions">
                {% for interest in interests %}
                <button
                    type="button"
                    class="interest-tag text-center"
                    onclick="toggleInterest(this, '{{ interest }}')"
                >
                    {{ interest }}
                </button>
                {% endfor %}
            </div>
        </div>

        <!-- Submit -->
        <div class="flex gap-4 pt-6 border-t border-gray-200">
            <button type="submit" class="btn-primary flex-1">
                Create Profile
            </button>
            <a href="/"
               hx-get="/"
               hx-trigger="click"
               hx-target="body"
               hx-swap="innerHTML"
               hx-push-url="true"
               class="btn-secondary flex-1 text-center">
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
    // Simple interest selection toggle (will be replaced with HTMX in full implementation)
    const selectedInterests = new Set();

    function toggleInterest(button, interest) {
        if (selectedInterests.has(interest)) {
            selectedInterests.delete(interest);
            if (button) button.classList.remove('selected');
        } else {
            selectedInterests.add(interest);
            if (button) button.classList.add('selected');
        }
        updateSelectedDisplay();
    }

    function removeInterest(interest) {
        selectedInterests.delete(interest);
        // Also remove 'selected' class from the grid button if it exists
        const gridButtons = document.querySelectorAll('#interest-suggestions button');
        gridButtons.forEach(btn => {
            if (btn.textContent.trim() === interest) {
                btn.classList.remove('selected');
            }
        });
        updateSelectedDisplay();
    }

    function updateSelectedDisplay() {
        const container = document.getElementById('selected-interests');
        if (selectedInterests.size === 0) {
            container.innerHTML = '<span class="text-xs text-gray-500">No interests selected yet</span>';
        } else {
            container.innerHTML = Array.from(selectedInterests)
                .map(i => `<span class="interest-tag cursor-pointer hover:opacity-80" onclick="removeInterest('${i}')">${i}</span>`)
                .join('');
        }
    }
</script>
{% endblock %}
